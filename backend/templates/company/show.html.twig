{% extends 'base.html.twig' %}

{% block title %}{{ parent() }} - {{ page_title }}{% endblock %}

{% block main %}
    <div class="container">
        <div class="section level-left">
            <div class="level-item">
                <h2 class="level-item subtitle has-text-info is-3">{{ company.name }}</h2>
            </div>
            <button class="level-item button is-info is-small is-size-4">{{ company.isCustomer ? 'Client' : 'Prospect' }}</button>
        </div>
        <div class="tile is-ancestor">
            {# Début des Tiles #}
            <div class="tile is-parent is-3 is-vertical">
                <article class="tile is-child">
                    <figure class="image is-4by3">
                        <img src="{{ company.picture }}">
                    </figure>
                </article>
            </div>
            <div class="tile is-parent is-vertical">
                <article class="tile is-child notification is-primary">
                    <p class="title">Description</p>
                    <p class="subtitle">{{ company.description }}</p>
                </article>
                <div class="tile">
                    <article class="tile is-child is-8">
                        <p class="title">Contacts</p>
                        {% for contact in company.contacts %}
                            <p class="content">
                                <a href="{{ path('contact_show', {'id' : contact.id}) }}">
                                    <span class="subtitle">{{ contact.person.firstname }} {{ contact.person.lastname }}</span>
                                </a> &nbsp;-&nbsp;
                                <span class="has-text-weight-bold">{{ contact.contactType.title }}</span></br>
                                <i class="fas fa-mobile-alt"></i> {{ contact.person.cellPhone }} &nbsp;&nbsp;&nbsp;
                                <i class="fas fa-phone"></i> {{ contact.person.businessPhone }}
                            </p>
                        {% endfor %}
                        <p class="title">Commercial</p>
                        {% if company.user.id is defined %}
                        <p class="content">
                            <a href="{{ path('user_show', {'id' : company.user.id}) }}">
                                <span class="subtitle">{{ company.user.person.firstname }} {{ company.user.person.lastname }}</span>
                            </a> &nbsp;-&nbsp;
                            <i class="fas fa-mobile-alt"></i> {{ company.user.person.cellPhone }} &nbsp;&nbsp;&nbsp;
                            <i class="fas fa-phone"></i> {{ company.user.person.businessPhone }}
                        </p>
                        {% endif %}
                    </article>
                    <article class="tile is-child">
                        <p class="title">Informations</p>
                        <p>Discount sur catalogue: &nbsp; <span class="has-text-weight-bold">{{ (company.discount is not null) ? company.discount.title : '0%' }}</span></p>
                        <p>SIREN: &nbsp; <span class="has-text-weight-bold">{{ company.sirenNumber }}</span></p>
                        <p>Enregistrement: &nbsp; <span class="has-text-weight-bold">{{ company.createdAt|date('d-m-Y') }}</span></p>
                        <p>Mise à jour: &nbsp; <span class="has-text-weight-bold">{{ company.updatedAt|date('d-m-Y') }}</span></p>
                    </article>
                </div>
                <div class="section tile">
                    <article class="tile is-child ">
                        <div class="level">
                            <div class="level-left">
                                <h2 class=" level-item title is-3">Adresses</h2>
                            </div> 
                            {% if is_granted('ROLE_SALES') %}
                                <div class="level-right">
                                    <a class="level-item" href="{{ path('company_address_new', {'id' : company.id}) }}">
                                        <button type="submit" class="level-item button is-success s-small is-size-4"><i class="fas fa-plus-circle"></i></button>
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                        <table class="table is-fullwidth is-hoverable is-striped">
                            <thead>
                                <tr>
                                    <th>De</th>
                                    <th>Adresse</th>
                                    <th>Code postal</th>
                                    <th>Ville</th>
                                    <th>Pays</th>
                                    {% if is_granted('ROLE_SALES') %}
                                    <th>Actions</th>
                                    {% endif %}
                                </tr>
                            </thead>
                            <tbody>
                                {% for address in company.companyAddresses %}

                                    {% if address.isActive %}
                                        <tr>
                                            <td>{{ address.companyAddressType.title }}</td>
                                            <td>   
                                                {{ address.firstAddressField }}
                                                {% if (address.secondAddressField is not null) %}
                                                    ,</br>
                                                    {{address.secondAddressField}}
                                                {% endif %}
                                            </td>
                                            <td>{{ address.postalCode }}</td>
                                            <td>{{ address.city }}</td>
                                            <td>{{ address.country }}</td>
                                            {% if is_granted('ROLE_SALES') %}
                                            <td>
                                                <div class="level-left">
                                                    <a class="level-item" href="{{ path('company_address_edit', {'id': company.id, 'address_id': address.id}) }}">
                                                        <button type="submit" class="button is-info"><i class="fas fa-edit"></i></button>
                                                    </a>
                                                    <form class="level-item" action='{{ path('company_address_archive', {'id': address.id}) }}' method="POST">
                                                        <input class="" type="hidden" name="_method" value="PATCH">
                                                        {% include 'partial/_confirm_cancel_modal.html.twig' with {'message': 'Confirmation d\'Archivage'} %}
                                                        <button class="button showModalConfirm is-warning"><i class="fas fa-archive"></i></button>
                                                    </form>
                                                </div>
                                            </td>
                                            {% endif %}
                                        </tr>
                                    {% endif %}

                                {% endfor %}
                            </tbody>
                        </table>
                    </article>
                </div>
            </div>
            {# Fin des Tiles #}
        </div>

    </div>
{% endblock %}